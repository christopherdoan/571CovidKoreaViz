<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Time Series Plot</title>
		<script type="text/javascript" src="https://d3js.org/d3.v6.min.js"></script>
		
	</head>
	<body>
		<script type="text/javascript">

			//Width and height
			var width = 1000;
			var height = 600;
            var padding = 40;

            //Create SVG element
            var svg = d3.select("body")
						.append("svg")
						.attr("width", width)
						.attr("height", height);

            //Scales
            var xScale = d3.scaleTime().range([padding, width - padding * 2]);
            var yScale = d3.scaleLinear().range ([height - padding, padding]);

            //Dates Data
            var rowConverter = function(d) {
				return {
					date : d3.timeParse("%Y-%m-%d")(d.date),
                    total: parseInt(d.total),
                    male: parseInt(d.male),
                    female: parseInt(d.female),
                    age_0: parseInt(d.age_0),
                    age_10: parseInt(d.age_10),
                    age_20: parseInt(d.age_20),
                    age_30: parseInt(d.age_30),
                    age_40: parseInt(d.age_40),
                    age_50: parseInt(d.age_50),
                    age_60: parseInt(d.age_60),
                    age_70: parseInt(d.age_70),
                    age_80: parseInt(d.age_80)
				}
                ;
			}
            
            var promises = [d3.csv("/data/ConfirmedData.csv", rowConverter), 
                d3.csv("/data/DeceasedData.csv", rowConverter)];
            var myDataPromises = Promise.all(promises);
            
            myDataPromises.then(function(data){

                currDataset = data[0]
                
                xScale = d3.scaleTime()
							   .domain(d3.extent(currDataset, function(d) { return d.date; }))
							   .range([padding, width - padding * 2]);

                yScale = d3.scaleLinear()
							   .domain([
									d3.max(currDataset, function(d) { return d.total; }),
                                    d3.min(currDataset, function(d) { return d.total; })
								])
							   .range([ padding, height - padding]);
    
                var xAxis = d3.axisBottom()
					.scale(xScale);
                
                var yAxis = d3.axisLeft()
					.scale(yScale);

                svg.append("g")
                    .attr("transform", "translate(0," + (height - padding) + ")")
                    .call(xAxis);

                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + (padding) + ",0)")
                    .call(yAxis);

                svg.append("path")
                    .datum(currDataset)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return xScale(d.date) })
                        .y(function(d) { return yScale(d.total) })
                        )
            });
        
            
		</script>
	</body>
</html>